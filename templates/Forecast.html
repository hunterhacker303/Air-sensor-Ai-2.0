<div class="space-y-8">

    <!-- HEADER -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
        <div>
            <div class="flex items-center gap-2 text-indigo-500 mb-2">
                <span class="text-xs font-bold uppercase tracking-widest">
                    ML Powered Prediction
                </span>
            </div>

            <h1 class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight">
                AI Air Quality Forecast
            </h1>
        </div>
    </div>

    <!-- LAYOUT -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- CHART -->
        <div class="lg:col-span-2 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 p-6">
            <h3 class="text-lg font-bold mb-6 text-gray-900 dark:text-white">
                Predicted AQI (Next 6 Hours)
            </h3>

            <!-- ðŸ”¥ FIX: fixed-height wrapper -->
            <div style="height:320px;">
                <canvas id="forecastChart"></canvas>
            </div>

            <div class="mt-4 flex items-center justify-center gap-6 text-sm text-gray-500">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-1 bg-amber-400"></div> Prediction
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-1 border-t border-dashed border-amber-400"></div>
                    Confidence Interval
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="space-y-6">

            <!-- TREND BOX -->
            <div class="bg-indigo-600 p-6 text-white">
                <div class="text-indigo-200 text-sm uppercase tracking-wider mb-1">Outlook</div>
                <div class="text-3xl font-bold">{{ trend }} Trend</div>

                <p class="mt-4 text-indigo-100 text-sm">
                    Based on current environmental data, PM2.5 levels are expected to
                    {{ trend | lower }} slightly over the next hour.
                </p>
            </div>

            <!-- RECOMMENDATION -->
            <div class="bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 p-6">
                <h4 class="font-bold mb-3">Recommendation</h4>

                <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                    {% if next_hour_aqi > 100 %}
                        Conditions are expected to deteriorate. Plan your commute accordingly or carry a mask.
                    {% else %}
                        Air quality is expected to remain stable. Safe for outdoor activities.
                    {% endif %}
                </p>

                <div class="w-full bg-gray-200 dark:bg-neutral-700 h-1">
                    <div class="bg-indigo-500 h-1" style="width: 85%;"></div>
                </div>

                <div class="text-right text-xs text-gray-500 mt-1">
                    85% Prediction Confidence
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ===== DATA FROM FLASK ===== */


const forecastData = [
    { time: "10:00", aqi: 145 },
    { time: "11:00", aqi: 142 },
    { time: "12:00", aqi: 138 },
    { time: "13:00", aqi: 134 },
    { time: "14:00", aqi: 130 },
    { time: "15:00", aqi: 127 }
];

/* ===== PREP DATA ===== */
const labels = forecastData.map(p => p.time);
const aqiValues = forecastData.map(p => p.aqi);

/* ===== CREATE CHART ONCE ===== */
new Chart(document.getElementById("forecastChart"), {
    type: "line",
    data: {
        labels: labels,
        datasets: [{
            label: "Predicted AQI",
            data: aqiValues,
            borderColor: "#f59e0b",
            backgroundColor: "rgba(245,158,11,0.15)",
            borderWidth: 2,
            fill: true,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,   // ðŸ”¥ CRITICAL FIX
        scales: {
            y: {
                beginAtZero: false
            }
        }
    }
});
</script>
